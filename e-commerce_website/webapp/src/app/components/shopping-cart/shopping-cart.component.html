<div class="container mt-4">

  <!-- Step 0: Shopping Cart -->
  <ng-container *ngIf="orderStep == 0">
    <h2 class="text-center mb-4">ğŸ›’ Your Shopping Cart</h2>

    <div *ngIf="cartItems.length > 0; else emptyCart">
      <div class="row">
        <!-- Cart Items -->
        <div class="col-md-8">
          <div class="card p-3 mb-3" *ngFor="let item of cartItems">
            <div class="row g-3 align-items-center">
              <div class="col-4 col-md-3">
                <img [src]="'http://localhost:3000/' + item.product.images[0] || 'https://via.placeholder.com/150'" class="img-fluid rounded shadow-sm" />
              </div>
              <div class="col-8 col-md-6">
                <h5>{{ item.product.name }}</h5>
                <p class="text-muted">Price: â‚¹{{ item.product.price }}</p>
                <div class="d-flex align-items-center">
                  <button class="btn btn-sm btn-outline-secondary me-2" (click)="updateQuantity(item, -1)">-</button>
                  <span class="fw-bold mx-2">{{ item.quantity }}</span>
                  <button class="btn btn-sm btn-outline-secondary ms-2" (click)="updateQuantity(item, 1)">+</button>
                </div>
              </div>
              <div class="col-12 col-md-3 text-md-end">
                <button class="btn btn-danger btn-sm" (click)="removeFromCart(item.product._id)">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Summary -->
        <div class="col-md-4">
          <div class="card p-3 shadow-sm">
            <h4>Order Summary</h4>
            <p>Total Items: <strong>{{ totalItems }}</strong></p>
            <p>Total Price: <strong>â‚¹{{ totalPrice }}</strong></p>
            <button (click)="checkout()" class="btn btn-primary w-100">Checkout</button>
            <button routerLink="/home" class="btn btn-secondary w-100 mt-2">ğŸ  Back to Home</button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #emptyCart>
      <div class="text-center">
        <h4>Your cart is empty! ğŸ›’</h4>
        <button class="btn btn-primary mt-3" routerLink="/products">Shop Now</button>&nbsp;
        <button routerLink="/home" class="btn btn-secondary mt-3">ğŸ  Back to Home</button>
      </div>
    </ng-template>
  </ng-container>

  <!-- Step 1: Address Form -->
  <ng-container *ngIf="orderStep == 1">
    <h2 class="text-center mb-4">ğŸ  Delivery Address</h2>
    <div class="d-flex justify-content-center">
      <form [formGroup]="addressForm" class="p-4 shadow-lg rounded-4 bg-white w-100" style="max-width: 600px;">
        <mat-form-field appearance="outline" class="w-100 mb-3">
          <mat-label>Address Line 1</mat-label>
          <input matInput formControlName="address1">
        </mat-form-field>
        <mat-form-field appearance="outline" class="w-100 mb-3">
          <mat-label>Address Line 2</mat-label>
          <input matInput formControlName="address2">
        </mat-form-field>
        <mat-form-field appearance="outline" class="w-100 mb-3">
          <mat-label>City</mat-label>
          <input matInput formControlName="city">
        </mat-form-field>
        <mat-form-field appearance="outline" class="w-100 mb-4">
          <mat-label>Pin Code</mat-label>
          <input matInput formControlName="pincode">
        </mat-form-field>
        <div class="d-grid gap-2">
          <button (click)="addAddress()" class="btn btn-outline-secondary w-100">Continue</button>
          <button routerLink="/home" class="btn btn-outline-secondary w-100">ğŸ  Back to Home</button>
        </div>
      </form>
    </div>
  </ng-container>

  <!-- Step 2: Payment Method -->
  <ng-container *ngIf="orderStep == 2">
    <h2 class="text-center mb-4">ğŸ’³ Select Payment Method</h2>
    <div class="d-flex justify-content-center">
      <div class="p-4 shadow-lg rounded-4 bg-white w-100" style="max-width: 500px;">
        <mat-radio-group formControlName="paymentType" class="d-flex flex-column gap-2 mb-4">
          <mat-radio-button value="cash">ğŸ’µ Cash on Delivery</mat-radio-button>
          <mat-radio-button value="card" disabled>ğŸ’³ Card (Coming Soon)</mat-radio-button>
        </mat-radio-group>
        <div class="d-grid gap-2">
          <button (click)="completeOrder()" class="btn btn-success w-100">âœ… Complete Order</button>
          <a routerLink="/home" class="btn btn-outline-primary w-100">â† ğŸ  Back to Home</a>
        </div>
      </div>
    </div>
  </ng-container>

</div>
